<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Interactive 360&deg; Image with Video</title>
    <meta name="description" content="Interactive 360&deg; Image with Video - A-Frame">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/mayognaise/aframe-open-page-iframe/3dc8f2b8/dist/aframe-open-page-iframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- 360-degree image background -->
      <a-sky src="./assets/oldfield.jpg" rotation="0 -130 0"></a-sky>

      <!-- Text in VR space -->
      <a-text font="kelsonsans" value="360 image with video" width="6" position="-2.5 0.25 -1.5" rotation="0 15 0"></a-text>

      <!-- Thumbnail image for the video -->
      <a-image src="./assets/paul.jpg" width="8" height="4.5" position="0 2 -10" id="thumbnailImage" clickable open-page-iframe="#video"></a-image>

      <!-- Video player (hidden by default) -->
      <a-entity id="videoContainer" open-page-iframe="#video">
        <a-video response-type="arraybuffer" id="video" visible="false"></a-video>
      </a-entity>

      <!-- WebXR hand tracking with cursor (Left hand) -->
      <a-entity id="leftHand" oculus-touch-controls="hand: left" raycaster="showLine: true; far: 30;" line="color: red;"></a-entity>

      <!-- WebXR hand tracking with cursor (Right hand) -->
      <a-entity id="rightHand" oculus-touch-controls="hand: right" raycaster="showLine: true; far: 30;" line="color: green;"></a-entity>

      <script>
        // Register the clickable component
        AFRAME.registerComponent('clickable', {
          init: function () {
            var el = this.el;

            // Function to toggle video playback
            function toggleVideo() {
              var videoContainer = document.getElementById('videoContainer');
              var thumbnailImage = document.getElementById('thumbnailImage');
              var video = document.getElementById('video');

              if (videoContainer && video) {
                // Show/hide the video container
                videoContainer.setAttribute('visible', !videoContainer.getAttribute('visible'));
                // Hide the thumbnail image
                thumbnailImage.setAttribute('visible', 'false');
                
                // Set the video source (modify the video path accordingly)
                video.setAttribute('src', './assets/coba.mp4');

                // Start playing the video
                if (videoContainer.getAttribute('visible')) {
                  video.play();
                }
              }
            }

            // Event listener for laser intersection on the left hand
            el.addEventListener('raycaster-intersected', function (event) {
              var leftHand = document.getElementById('leftHand');
              if (leftHand && leftHand.components['oculus-touch-controls'].isPressed('trigger')) {
                // Check if the intersected entity has the clickable component
                if (event.detail.el.components.clickable) {
                  toggleVideo();
                }
              }
            });

            // Event listener for laser intersection on the right hand
            el.addEventListener('raycaster-intersected', function (event) {
              var rightHand = document.getElementById('rightHand');
              if (rightHand && rightHand.components['oculus-touch-controls'].isPressed('trigger')) {
                // Check if the intersected entity has the clickable component
                if (event.detail.el.components.clickable) {
                  toggleVideo();
                }
              }
            });
          }
        });
      </script>
    </a-scene>
  </body>
</html>